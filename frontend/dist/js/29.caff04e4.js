"use strict";(self["webpackChunkwebserver"]=self["webpackChunkwebserver"]||[]).push([[29],{7029:function(e,s,t){t.r(s),t.d(s,{default:function(){return ke}});var i=t(6768),o=t(5130),r=t(4232);const a={class:"container"},n={class:"chat_sidebar"},l={class:"search"},d=["onClick"],c={key:0,class:"recieve_message"},h=["onClick"],u={key:0,class:"recieve_message"},m={class:"chat_content"},p={class:"header"},_={class:"selected_room"},k={key:0,class:"error"},g={class:"header_right"},f={class:"user"},v={class:"message_container"},L={class:"msg_name"},w={class:"text"},C={class:"chat_footer"};function b(e,s,t,b,E,y){const S=(0,i.g2)("EditUser"),M=(0,i.g2)("ChangePass");return(0,i.uX)(),(0,i.CE)(i.FK,null,[E.isShowEditUser?((0,i.uX)(),(0,i.Wv)(S,{key:0,onCloseEdit:y.closeEditUser,onChangePass:y.showChangePass,user:E.user,server_addr:t.server_addr},null,8,["onCloseEdit","onChangePass","user","server_addr"])):(0,i.Q3)("",!0),E.isShowChangePass?((0,i.uX)(),(0,i.Wv)(M,{key:1,onClose:y.closeChangePass,user_id:E.user.id,server_addr:t.server_addr},null,8,["onClose","user_id","server_addr"])):(0,i.Q3)("",!0),(0,i.Lk)("div",a,[(0,i.Lk)("div",n,[(0,i.Lk)("div",l,[(0,i.bo)((0,i.Lk)("input",{type:"search","onUpdate:modelValue":s[0]||(s[0]=e=>E.user_name=e),id:"search",placeholder:"Поиск...",autocomplete:"off"},null,512),[[o.Jo,E.user_name]])]),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(E.roomsList,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,onClick:s=>y.roomClick(e),class:(0,r.C4)({selected:y.roomSelected(e.id)})},[(0,i.eW)((0,r.v_)(e.name)+" ",1),e.isActiveMessage?((0,i.uX)(),(0,i.CE)("span",c,(0,r.v_)(e.numOfMessages),1)):(0,i.Q3)("",!0)],10,d)))),128))]),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(y.filteredList,(e=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,onClick:s=>y.userListClick(e),class:(0,r.C4)({selected:y.roomSelected(e.id)})},[(0,i.eW)((0,r.v_)(e.name)+" ",1),(0,i.Lk)("p",{class:(0,r.C4)(["inline",{online:e.online}])},(0,r.v_)(y.setline(e.online)),3),e.isActiveMessage?((0,i.uX)(),(0,i.CE)("span",u,(0,r.v_)(e.numOfMessages),1)):(0,i.Q3)("",!0)],10,h)))),128))])]),(0,i.Lk)("section",m,[(0,i.Lk)("div",p,[(0,i.Lk)("div",_,[(0,i.Lk)("h1",null,(0,r.v_)(E.selected_room.name),1),(0,i.bo)((0,i.Lk)("p",{class:(0,r.C4)(["inline",{online:E.selected_room.online}])},(0,r.v_)(y.setline(E.selected_room.online)),3),[[o.aG,!E.isRoom]])]),(0,i.Lk)("h2",null,[E.connection_error?((0,i.uX)(),(0,i.CE)("span",k,"network error")):(0,i.Q3)("",!0)]),(0,i.Lk)("div",g,[(0,i.Lk)("p",f,(0,r.v_)(y.setUserName()),1),(0,i.Lk)("button",{onClick:s[1]||(s[1]=(...e)=>y.showEditUser&&y.showEditUser(...e)),class:"i_properties icon"}),(0,i.Lk)("button",{onClick:s[2]||(s[2]=(...e)=>y.logout&&y.logout(...e)),class:"i_logout icon"})])]),(0,i.Lk)("div",v,[(0,i.Lk)("div",{class:"messages",id:"messages",onClick:s[3]||(s[3]=e=>y.messageSpaceClick())},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(E.rooms[y.indexOfSelectedRoom].messages,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:"m-"+s,class:"message"},[(0,i.Lk)("div",{class:(0,r.C4)({send:"me"==e.from,response:"other"==e.from})},[(0,i.Lk)("ul",null,[(0,i.Lk)("li",L,(0,r.v_)(e.name),1),(0,i.Lk)("li",w,(0,r.v_)(e.message),1)])],2)])))),128))])]),(0,i.Lk)("div",C,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>E.new_message=e),type:"text",placeholder:"Сообщение...",onKeyup:s[5]||(s[5]=(0,o.jR)(((...e)=>y.send_message&&y.send_message(...e)),["enter"]))},null,544),[[o.Jo,E.new_message]]),(0,i.Lk)("i",{class:"i_send icon",onClick:s[6]||(s[6]=(...e)=>y.send_message&&y.send_message(...e))})])])])],64)}t(4114);var E=t(8355);const y=e=>((0,i.Qi)("data-v-1f44feaa"),e=e(),(0,i.jt)(),e),S={class:"popup_wrapper",ref:"popup_wrapper"},M={class:"edit_popup"},U={key:0,class:"reuslt_ok"},A={key:1,class:"result_err"},O={class:"blok"},R=y((()=>(0,i.Lk)("label",{for:"name"},"Имя:",-1))),P={class:"blok"},X=y((()=>(0,i.Lk)("label",{for:"familyname"},"Фамилия:",-1))),I={class:"blok"},x=y((()=>(0,i.Lk)("label",{for:"surname"},"Отчество:",-1))),Q={class:"blok"},V=y((()=>(0,i.Lk)("label",{for:"birthdate"},"Дата Рождения:",-1))),J={class:"change_pass"},$={class:"edit_footer"};function F(e,s,t,a,n,l){return(0,i.uX)(),(0,i.CE)("div",S,[(0,i.Lk)("div",M,[(0,i.Lk)("div",null,[n.resultOk?((0,i.uX)(),(0,i.CE)("p",U,"Данные успешно обновлены")):(0,i.Q3)("",!0),n.resultErr?((0,i.uX)(),(0,i.CE)("p",A,(0,r.v_)(n.errString),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",O,[R,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"name","onUpdate:modelValue":s[0]||(s[0]=e=>n.name=e)},null,512),[[o.Jo,n.name]])]),(0,i.Lk)("div",P,[X,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"familyname","onUpdate:modelValue":s[1]||(s[1]=e=>n.familyname=e)},null,512),[[o.Jo,n.familyname]])]),(0,i.Lk)("div",I,[x,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"surname","onUpdate:modelValue":s[2]||(s[2]=e=>n.surname=e)},null,512),[[o.Jo,n.surname]])]),(0,i.Lk)("div",Q,[V,(0,i.bo)((0,i.Lk)("input",{type:"date",id:"birthdate","onUpdate:modelValue":s[3]||(s[3]=e=>n.birthdate=e)},null,512),[[o.Jo,n.birthdate]])]),(0,i.Lk)("div",J,[(0,i.Lk)("button",{onClick:s[4]||(s[4]=(...e)=>l.changePass&&l.changePass(...e))},"Сменить пароль")]),(0,i.Lk)("div",$,[(0,i.Lk)("button",{class:"save",onClick:s[5]||(s[5]=(...e)=>l.updateUserInfo&&l.updateUserInfo(...e))},"Сохранить"),(0,i.Lk)("button",{class:"close",onClick:s[6]||(s[6]=(...e)=>l.closeEdit&&l.closeEdit(...e))},"Закрыть")])])],512)}var N={props:{user:{type:Object},server_addr:{type:String,default:"localhos:8080"}},data(){return{id:this.user.id,name:this.user.name,familyname:this.user.familyname,surname:this.user.surname,birthdate:this.user.birthdate,resultOk:!1,resultErr:!1,errString:""}},mounted(){let e=this;document.addEventListener("click",(function(s){s.target==e.$refs["popup_wrapper"]&&e.closeEdit()}))},methods:{closeEdit(){this.$emit("closeEdit")},changePass(){this.$emit("changePass")},updateUserInfo(){E.A.post("http://"+this.server_addr+"/userupdate",{id:this.id,name:this.name,familyname:this.familyname,surname:this.surname,birthdate:this.birthdate}).then((()=>{this.resultOk=!0})).catch((e=>{this.resultErr=!0,this.errString="Ошибка: "+e}))}}},K=t(1241);const W=(0,K.A)(N,[["render",F],["__scopeId","data-v-1f44feaa"]]);var j=W;const q=e=>((0,i.Qi)("data-v-749ee359"),e=e(),(0,i.jt)(),e),D={class:"popup_wrapper",ref:"popup_wrapper"},G={class:"change_popup"},H={class:"close"},B=q((()=>(0,i.Lk)("h1",null,"Сменить пароль",-1))),T={class:"error"},z=q((()=>(0,i.Lk)("p",null,"Пороль обновлён",-1))),Y=[z],Z={class:"input"},ee=["type"],se={class:"input"},te=["type"],ie={key:0,class:"input"},oe=["type"],re={class:"check_block"},ae={class:"check"},ne=q((()=>(0,i.Lk)("label",{for:"show_pass"},"Показать пароль",-1))),le={class:"button_block"},de=["disabled"];function ce(e,s,t,a,n,l){return(0,i.uX)(),(0,i.CE)("div",D,[(0,i.Lk)("div",G,[(0,i.Lk)("form",{onSubmit:s[5]||(s[5]=(0,o.D$)(((...e)=>l.changePass&&l.changePass(...e)),["prevent"]))},[(0,i.Lk)("div",H,[(0,i.Lk)("p",{onClick:s[0]||(s[0]=(...e)=>l.close&&l.close(...e)),title:"Закрыть"},"X")]),B,(0,i.bo)((0,i.Lk)("div",T,[(0,i.Lk)("p",null,"Error: "+(0,r.v_)(n.errResult),1)],512),[[o.aG,n.isEroor]]),(0,i.bo)((0,i.Lk)("div",null,Y,512),[[o.aG,n.isResult]]),(0,i.Lk)("div",Z,[(0,i.bo)((0,i.Lk)("input",{required:"",type:n.show_pass?"text":"password",placeholder:"текущий пароль","onUpdate:modelValue":s[1]||(s[1]=e=>n.old_password=e)},null,8,ee),[[o.hp,n.old_password]])]),(0,i.Lk)("div",se,[(0,i.bo)((0,i.Lk)("input",{required:"",type:n.show_pass?"text":"password",placeholder:"новый пароль","onUpdate:modelValue":s[2]||(s[2]=e=>n.new_password=e)},null,8,te),[[o.hp,n.new_password]])]),l.confirm?((0,i.uX)(),(0,i.CE)("div",ie,[(0,i.bo)((0,i.Lk)("input",{required:"",type:n.show_pass?"text":"password",placeholder:"подтвердите пароль","onUpdate:modelValue":s[3]||(s[3]=e=>n.confirmed_password=e)},null,8,oe),[[o.hp,n.confirmed_password]])])):(0,i.Q3)("",!0),(0,i.Lk)("div",re,[(0,i.Lk)("div",ae,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox",id:"show_pass","onUpdate:modelValue":s[4]||(s[4]=e=>n.show_pass=e)},null,512),[[o.lH,n.show_pass]]),ne])]),(0,i.Lk)("div",le,[(0,i.Lk)("button",{type:"submit",disabled:!l.check_pass,class:(0,r.C4)(l.check_pass?"activ":"non_activ")},"Подтвердить",10,de)])],32)])],512)}var he={props:{user_id:Number,server_addr:{type:String,default:"localhos:8080"}},data(){return{old_password:"",new_password:"",confirmed_password:"",show_pass:!1,isResult:!1,isEroor:!1,errResult:""}},mounted(){let e=this;document.addEventListener("click",(function(s){s.target==e.$refs["popup_wrapper"]&&e.close()}))},methods:{changePass(){E.A.post("http://"+this.server_addr+"/changepass",{id:this.user_id,old:this.old_password,new:this.new_password}).then((()=>{this.isResult=!0,this.isEroor=!1})).catch((e=>{this.isResult=!1,this.isEroor=!0,this.errResult=e.response.data}))},close(){this.$emit("close")}},computed:{confirm(){return this.new_password.length>4},check_pass(){return!(this.new_password.length<4)&&this.new_password==this.confirmed_password}}};const ue=(0,K.A)(he,[["render",ce],["__scopeId","data-v-749ee359"]]);var me=ue,pe={components:{EditUser:j,ChangePass:me},props:{server_addr:String},data(){return{isShowEditUser:!1,isShowChangePass:!1,roomsList:[{id:0,name:"Общие",isActiveMessage:!1,numOfMessages:0}],list:[{id:0,name:"",online:!1,isActiveMessage:!1,numOfMessages:0}],user_name:"",isRoom:!0,selected_room:{id:0,name:"Общие",online:!1},rooms:[{id:0,messages:[]}],user:{id:0,name:"",familyname:"",surname:"",birthdate:""},connection_ready:!1,connection_error:!1,websocket:null,new_message:"",messages:[],selectRoomMessages:[]}},mounted(){this.init_chat()},methods:{init_chat(){E.A.defaults.withCredentials=!0,E.A.get("http://"+this.server_addr+"/chat").then((e=>{this.user=e.data.user,this.list=e.data.list,this.fiil_nill_data(),this.init_ws_chat(this.user.id)})).catch((e=>{if("Network Error"!=e.message)return 401==e.response.status&&this.$router.push("/login"),"false"}))},fiil_nill_data(){for(let e=0;e<this.list.length;e++){this.list[e].isActiveMessage=!1,this.list[e].numOfMessages=0;let s=this.list[e].id;this.rooms.push({id:s,messages:[]})}},init_ws_chat(e){var s="ws://"+this.server_addr+"/ws?id="+e;this.websocket=new WebSocket(s),this.websocket.onopen=()=>{console.log("socket is open"),this.connection_ready=!0,this.connection_error=!1},this.websocket.onmessage=this.onSocketMesssage,this.websocket.onerror=this.onSockerError},onSocketMesssage(e){var s=JSON.parse(e.data);console.log(s),0==s.type&&this.processControlEvent(s),1==s.type&&this.processDataEvent(s)},onSockerError(e){this.connection_error=!0,this.connection_ready=!1,console.log(e)},send_message(){var e={from:this.user.id,message:this.new_message,to:this.selected_room.id,isroom:this.isRoom};this.websocket.send(JSON.stringify(e));let s=this.findRoom(this.selected_room.id);s.messages.push({from:"me",message:this.new_message}),this.new_message=""},processControlEvent(e){1==e.online&&this.setOnline(e.from),1==e.ofline&&this.setOfline(e.from)},processDataEvent(e){let s=this.nameFromId(e.from),t=0;e.isroom?(t=e.to,this.setActiveMessageInRoom(t)):(t=e.from,this.setActiveMessageInList(t));let i=this.findRoom(t);i.messages.push({from:"other",name:s,message:e.message});const o=document.getElementById("messages");o.scrollTo({top:o.scrollHeight,behavior:"smooth"})},setOnline(e){this.selected_room.id==e&&(this.selected_room.online=!0);for(let s=0;s<this.list.length;s++)if(this.list[s].id==e)return void(this.list[s].online=!0)},setOfline(e){this.selected_room.id==e&&(this.selected_room.online=!1);for(let s=0;s<this.list.length;s++)if(this.list[s].id==e)return void(this.list[s].online=!1)},findRoom(e){for(let s=0;s<this.rooms.length;s++)if(this.rooms[s].id==e)return this.rooms[s]},nameFromId(e){for(let s=0;s<this.list.length;s++)if(this.list[s].id==e)return this.list[s].name},setActiveMessageInRoom(e){for(let s=0;s<this.roomsList.length;s++)if(this.roomsList[s].id==e)return this.roomsList[s].isActiveMessage=!0,void this.roomsList[s].numOfMessages++},setActiveMessageInList(e){for(let s=0;s<this.list.length;s++)if(this.list[s].id==e)return this.list[s].isActiveMessage=!0,void this.list[s].numOfMessages++},logout(){E.A.defaults.withCredentials=!0,E.A.post("http://"+this.server_addr+"/logout",{id:this.id}).then((()=>{this.websocket.close(1e3,"работа закончена"),this.$router.push("/login")})).catch((e=>{console.log(e)}))},setline(e){return 1==e?"online":"offline"},setUserName(){return""==this.user.name?this.user.login:this.user.name+" "+this.user.surname+" "+this.user.familyname},showEditUser(){this.isShowEditUser=!0},closeEditUser(){this.isShowEditUser=!1},showChangePass(){this.isShowChangePass=!0,this.isShowEditUser=!1},closeChangePass(){this.isShowChangePass=!1,this.isShowEditUser=!0},userListClick(e){this.isRoom=!1,e.isActiveMessage=!1,e.numOfMessages=0,this.selected_room.id=e.id,this.selected_room.name=e.name,this.selected_room.online=e.online},messageSpaceClick(){if(this.isRoom){for(let e=0;e<this.roomsList.length;e++)if(this.roomsList[e].id==this.selected_room.id)return this.roomsList[e].isActiveMessage=!1,void(this.roomsList[e].numOfMessages=0)}else for(let e=0;e<this.list.length;e++)if(this.list[e].id==this.selected_room.id)return this.list[e].isActiveMessage=!1,void(this.list[e].numOfMessages=0)},roomClick(e){this.isRoom=!0,e.isActiveMessage=!1,e.numOfMessages=0,this.selected_room.id=e.id,this.selected_room.name=e.name},roomSelected(e){return e==this.selected_room.id}},computed:{filteredList(){let e=this.user_name;return this.list.filter((s=>s.name.toLowerCase().includes(e.toLowerCase())))},indexOfSelectedRoom(){for(let e=0;e<this.rooms.length;e++)if(this.rooms[e].id==this.selected_room.id)return e;return-1}}};const _e=(0,K.A)(pe,[["render",b],["__scopeId","data-v-141b1f93"]]);var ke=_e}}]);
//# sourceMappingURL=29.caff04e4.js.map