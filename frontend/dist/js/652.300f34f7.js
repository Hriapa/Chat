"use strict";(self["webpackChunkwebserver"]=self["webpackChunkwebserver"]||[]).push([[652],{4652:function(e,s,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,s){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,s||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}function n(e){var s=a(e,"string");return"symbol"==r(s)?s:s+""}function o(e,s,t){return s=n(s),s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}t.d(s,{T:function(){return V}});t(4114),t(6573),t(8100),t(7936),t(7467),t(4732),t(9577);const i={ControlMessage:0,DataMessage:1,AckMessage:2,ErrMessage:3},u={UserNameRequest:1,UserNameResponse:2,Connect:3,Disconnect:4,Registration:5,UserUpdate:6,UserInfo:7,UsersList:8,MessagesRequest:9,NumberOfMessages:10};let d={value:0,toString(){switch(this.value){case u.UserNameRequest:return"user name request";case u.UserNameResponse:return"user name response";case u.Connect:return"connect";case u.Disconnect:return"disconnect";case u.Registration:return"registration";case u.UserUpdate:return"user update";case u.UserInfo:return"user info";case u.UsersList:return"users list";case u.MessagesRequest:return"message request";case u.NumberOfMessages:return"number of messages";default:return"unknown command"}}},l={Name:"",Surname:"",Familyname:"",Birthdate:"",decode(e){let s=e.length,t=0,r=new E;while(s>t){let a=e.subarray(t);switch(t+=1,127&a[0]){case S.Name:t+=r.decode(e.subarray(t)),this.Name=r.value;break;case S.Surname:t+=r.decode(e.subarray(t)),this.Surname=r.value;break;case S.Familyname:t+=r.decode(e.subarray(t)),this.Familyname=r.value;break;case S.Birthdate:this.Birthdate=c(e.subarray(t)),t+=4;break;default:t=s;break}}},code(){let e=[],s=[],t=[],r=[],a=[],n=new E;return""!=this.Name&&(n.value=this.Name,e=n.code(),e.unshift(S.Name)),""!=this.Surname&&(n.value=this.Surname,s=n.code(),s.unshift(S.Surname)),""!=this.Familyname&&(n.value=this.Familyname,t=n.code(),t.unshift(S.Familyname)),""!=this.Birthdate&&(r=h(this.Birthdate)),a.concat(e,s,t,r)},clear(){this.Name="",this.Surname="",this.Familyname="",this.Birthdate=""}},c=function(e){if(e.length<4)return;let s=e[0],t=e[1],r=new Uint8Array([e[2],e[3]]),a=new DataView(r.buffer);return String(a.getUint16())+"-"+String(t)+"-"+String(s)},h=function(e){let s=Date.parse(e),t=new Date(s),r=[S.Birthdate];return r.push(t.getDate()),r.push(t.getMonth()+1),r.push(Math.floor(t.getFullYear()/256)),r.push(t.getFullYear()%256),r},m={ListCommand:"",NumberOfItems:0,ListElements:new Map,decode(e){let s=0,t=e;if(this.ListCommand=b(t[0]),s+=1,t=e.subarray(s),(127&t[0])==S.NumberOfItems){let r=new A(0);s+=r.decode(t),this.NumberOfItems=r.value,t=e.subarray(s)}if((127&t[0])!=S.ListElements)return"list elements decode error";s+=1,t=e.subarray(s);let r=new q,a=new E,n=!1,o=0,i=0;while(e.length>s)s+=r.decode(t),i=r.value,t=e.subarray(s),s+=a.decode(t),t=e.subarray(s),n=t[0]>>4==15,s+=1,!0&t[0]?(s+=r.decode(t.subarray(1)),o=r.value):o=0,t=e.subarray(s),this.ListElements.set(i,{online:n,name:a.value,nrm:o})},clear(){this.ListCommand="",this.NumberOfItems=0,this.ListElements.clear()}};const g={setUserList:1,updateUserList:2,refreshUserList:3};function b(e){switch(e){case g.setUserList:return"set list";case g.updateUserList:return"update list";case g.refreshUserList:return"refresh list";default:return"reserved"}}let f={RoomId:0,LastMessageNumber:0,decode(e){let s=e,t=0,r=new q(0);return e.length<4?(console.error("message request decode error, raw length too short"),"message request decode error, raw length too short"):(t=r.decode(s),0==t?(console.error("message request decode error"),"message request decode error"):(this.RoomId=r.value,s=s.subarray(t),r.decode(s),void(this.LastMessageNumber=r.value)))},code(){let e=[],s=new q(this.RoomId),t=s.code();s.value=this.LastMessageNumber;let r=s.code();return e.concat(t,r)},clear(){this.RoomId=0,this.LastMessageNumber=0}},y={RoomId:0,NumOfMessages:0,decode(e){let s=e,t=0,r=new q(0);return e.length<2?(console.error("message request decode error, raw length too short"),"message request decode error, raw length too short"):(t=r.decode(s),0==t?(console.error("message request decode error"),"message request decode error"):(this.RoomId=r.value,s=s.subarray(t),r.decode(s),void(this.NumOfMessages=r.value)))},code(){let e=[],s=new q(this.RoomId),t=s.code();s.value=this.LastMessageNumber;let r=s.code();return e.concat(t,r)},clear(){this.RoomId=0,this.NumOfMessages=0}},v={ControlMessageType:d,UserId:0,UserName:"",UserParameter:l,UsersList:m,MessagesRequest:f,NumberOfMessages:y,clear:function(){this.ControlMessageType.value=0,this.UserId=0,this.UserName="",this.UserParameter.clear(),this.UsersList.clear(),this.MessagesRequest.clear(),this.NumberOfMessages.clear()},decode:function(e){if(e.length<2)return void console.error("Error control command decode");v.ControlMessageType.value=e[0];let s=1,t=new q(0);if(1==e.length)return;let r=new E;switch(e[0]){case u.UserNameRequest:break;case u.UserNameResponse:r.decode(e.subarray(s)),this.UserName=r.value;break;case u.Connect:case u.Disconnect:t.decode(e.subarray(s)),this.UserId=t.value;break;case u.Registration:case u.UserUpdate:s+=t.decode(e.subarray(s)),this.UserId=t.value,r.decode(e.subarray(s)),this.UserName=r.value;break;case u.UserInfo:this.UserParameter.decode(e.subarray(s));break;case u.UsersList:this.UsersList.decode(e.subarray(s));break;case u.MessagesRequest:this.MessagesRequest.decode(e.subarray(s));break;case u.NumberOfMessages:this.NumberOfMessages.decode(e.subarray(s));break}},code:function(){let e=[i.ControlMessage];e.push(this.ControlMessageType.value);let s=new q(this.UserId),t=new E,r=[];switch(this.ControlMessageType.value){case u.UserNameRequest:break;case u.UserNameResponse:t.value=this.UserName,r=t.code();break;case u.Connect:case u.Disconnect:r=s.code();break;case u.Registration:case u.UserUpdate:r=s.code(),t.value=this.UserName,r=r.concat(t.code());break;case u.UserInfo:r=this.UserParameter.code();break;case u.MessagesRequest:r=this.MessagesRequest.code();break;case u.NumberOfMessages:r=this.NumberOfMessages.code();break;default:break}return new Uint8Array(e.concat(r))}};const U={NewMessage:1,OldMessage:2,UpdateMessage:3};let w={value:0,toString(){switch(this.value){case U.NewMessage:return"new message";case U.OldMessage:return"old message";case U.UpdateMessage:return"update message";default:return"unknown command"}}};const p={Text:1,Image:2,Audio:3};let I={value:0,toString(){switch(this.value){case p.Text:return"text";case p.Image:return"image";case p.Audio:return"audio";default:return"unknown format"}}};const N={First:2,Middle:0,Last:1};let M={Fragmentation:{On:!1,FragmentType:0,Counter:0},Data:Uint8Array,decode(e){let s=new B([]),t=1;return this.Fragmentation.On=e[0]>>>7==1,1==this.Fragmentation.On&&(this.Fragmentation.FragmentType=e[1]>>>6,this.Fragmentation.Counter=63&e[1],t+=1),t+=s.decode(e.subarray(t)),this.Data=s.value,t},code(){let e=[S.UserData],s=new B(this.Data);return this.Fragmentation.On&&(e[0]=128|e[0],e.push(this.Fragmentation.FragmentType<<6|63&this.Fragmentation.Counter)),e.concat(s.code())},clear(){this.Fragmentation.On=!1,this.Fragmentation.FragmentType=0,this.Fragmentation.Counter=0,this.Data=""}},R={DataMessageType:w,DataMessageFormat:I,IndexNumber:0,UserId:0,RoomId:NaN,UserData:M,clear:function(){this.DataMessageType.value=0,this.DataMessageFormat.value=0,this.IndexNumber=0,this.UserId=0,this.RoomId=NaN,this.UserData.clear()},decode:function(e){this.DataMessageType.value=e[0],this.DataMessageFormat.value=e[1];let s=new q(0),t=2;t+=s.decode(e.subarray(t)),this.IndexNumber=s.value;let r=e.subarray(t),a=new A(0);(127&r[0])==S.UserId&&(t+=a.decode(e.subarray(t)),this.UserId=a.value,r=e.subarray(t)),(127&r[0])==S.RoomId&&(t+=a.decode(e.subarray(t)),this.RoomId=a.value,r=e.subarray(t)),e.length!=t&&(127&r[0])==S.UserData&&this.UserData.decode(r)},code:function(){let e=[i.DataMessage];e.push(this.DataMessageType.value),e.push(this.DataMessageFormat.value);let s=[],t=[],r=[],a=[],n=new q(this.IndexNumber),o=new A;return s=n.code(),0!=this.UserId&&(o.value=this.UserId,t=o.code(S.UserId)),0==isNaN(this.RoomId)&&(o.value=this.RoomId,r=o.code(S.RoomId)),a=this.UserData.code(),new Uint8Array(e.concat(s,t,r,a))}};const k={Send:1,Receive:2,Read:3};let D={value:0,toString(){switch(this.value){case k.Send:return"send";case k.Receive:return"receive";case k.Read:return"read";default:return"unknown command"}}},L={AckMessageType:D,IndexNumber:0,UserId:0,RoomId:NaN,clear:function(){this.AckMessageType.value=0,this.IndexNumber=0,this.UserId=0,this.RoomId=NaN},decode:function(e){this.AckMessageType.value=e[0];let s=new q(0),t=1;t+=s.decode(e.subarray(t)),this.IndexNumber=s.value;let r=e.subarray(t),a=new A(0);(127&r[0])==S.UserId&&(t+=a.decode(e.subarray(t)),this.UserId=a.value,r=e.subarray(t)),(127&r[0])==S.RoomId&&(t+=a.decode(e.subarray(t)),this.RoomId=a.value,r=e.subarray(t))},code:function(){let e=[i.AckMessage];e.push(this.AckMessageType.value);let s=[],t=[],r=[],a=new q(this.IndexNumber),n=new A(0);return s=a.code(),0!=this.UserId&&(n.value=this.UserId,t=n.code(S.UserId)),0==isNaN(this.RoomId)&&(n.value=this.RoomId,r=n.code(S.RoomId)),new Uint8Array(e.concat(s,t,r))}};const F={Control:1,Data:2};let x={value:0,toString(){switch(this.value){case F.Control:return"control";case F.Data:return"data";default:return"unknown error type"}}},T={ErrMessageType:x,IndexNumber:0,UserId:0,RoomId:NaN,clear:function(){this.ErrMessageType.value=0,this.IndexNumber=0,this.UserId=0,this.RoomId=NaN},decode:function(e){this.ErrMessageType.value=e[0];let s=new q(0),t=1;t+=s.decode(e.subarray(t)),this.IndexNumber=s.value;let r=e.subarray(t),a=new A(0);(127&r[0])==S.UserId&&(t+=a.decode(e.subarray(t)),this.UserId=a.value,r=e.subarray(t)),(127&r[0])==S.RoomId&&(t+=a.decode(e.subarray(t)),this.RoomId=a.value,r=e.subarray(t))},code:function(){let e=[i.Error];e.push(this.ErrMessageType.value);let s=[],t=[],r=new q(this.IndexNumber),a=new A(0);return s=r.code(),0!=this.UserId?(a.value=this.UserId,t=a.code(S.UserId)):0==isNaN(this.RoomId)&&(a.value=this.RoomId,t=a.code(S.RoomId)),new Uint8Array(e.concat(s,t))}};const S={UserId:1,RoomId:2,Name:3,Surname:4,Familyname:5,Birthdate:6,UserName:7,ListElements:8,NumberOfItems:9,LastMessageNumber:10,UserData:11},C={first:2,middle:0,last:1};function O(e){switch(e){case C.first:return"first fragment";case C.middle:return"middle fragment";case C.last:return"last fragment";default:return"unknown fragment type"}}class q{constructor(e){this.value=e}decode(e){if(void 0==e||0==e.length)return console.error("error, number decode"),0;let s=0;if(e[0]>>7==0)this.value=e[0];else{if(s=127&e[0],s+1>e.length||s>4)return console.error("error, number decode"),e.length;let t=new Uint8Array(4);for(let a=0;a<s;a++)t[3-a]=e[s-a];let r=new DataView(t.buffer);this.value=r.getUint32()}return s+1}code(){let e=[],s=this.value;if(s<128)e.push(s);else{e.unshift(255&s);while(s>=256)s>>>=8,e.unshift(255&s);e.unshift(128|e.length)}return e}}class A{constructor(e){this.value=e}decode(e){if(void 0==e||0==e.length)return console.error("error, number decode"),0;let s=1,t=1;if(e[0]>>7==1&&(s=e[1],t=2),s>e.length||s>4)return console.error("error, number decode"),e.length;let r=new Uint8Array(4);for(let n=0;n<s;n++)r[3-n]=e[t-1+s-n];let a=new DataView(r.buffer);return this.value=a.getUint32(),s+t}code(e){let s=[],t=this.value;s.unshift(255&t);while(t>=256)t>>>=8,s.unshift(255&t);return s.length>1?(s.unshift(s.length),s.unshift(128|e)):s.unshift(e),s}}class E{constructor(e){this.value=e}decode(e){if(void 0==e||0==e.length)return console.error("error, text data decode"),"";let s=new TextDecoder("utf-8"),t=0,r=0;return e[0]>>>7==1?(t=256*(127&e[0])+e[1],r+=2):(t=e[0],r+=1),e.length<t+r?(console.error("error, text data decode"),e.length):(this.value=s.decode(e.subarray(r,t+r)),t+r)}code(){let e=[],s=new TextEncoder,t=[...s.encode(this.value)],r=t.length;return r>32767?(console.error("error user data code. Data length increase max value"),t.push(0)):(r<128?e.push(r):(e.push(r>>>8),e.push(255&r),e[0]=128|e[0]),e.concat(t))}}class B{constructor(e){this.value=e}decode(e){if(void 0==e||0==e.length)return console.error("error, text data decode"),0;let s=0,t=0;return e[0]>>>7==1?(s=256*(127&e[0])+e[1],t+=2):(s=e[0],t+=1),e.length<s+t?(console.error("error, text data decode"),e.length):(this.value=e.subarray(t,s+t),s+t)}code(){let e=[],s=[...this.value],t=s.length;return t>32767?(console.error("error user data code. Data length increase max value"),s.push(0)):(t<128?e.push(t):(e.push(t>>>8),e.push(255&t),e[0]=128|e[0]),e.concat(s))}}class P{constructor(e,s){o(this,"store",new Map),o(this,"maxLength",32767),this.fullMessage=e,this.message=s}assembling(){switch(this.message.type){case N.First:this.startAssembling();break;case N.Middle:this.addFragment();break;case N.Last:this.completeAssembling();break}}startAssembling(){1==this.store.has(this.message.id)&&this.store.delete(this.message.id);let e=[],s={number:this.message.number,data:this.message.data};e.push(s),this.store.set(this.message.id,e)}addFragment(){if(0==this.store.has(this.message.id))return;let e={number:this.message.number,data:this.message.data};this.store.get(this.message.id).push(e)}completeAssembling(){if(0==this.store.has(this.message.id))return;console.log(this.store.get(this.message.id).length);let e=this.store.get(this.message.id).length*this.maxLength+this.message.data.length,s=new Uint8Array(e),t=0;for(let r of this.store.get(this.message.id))s.set(r.data,[t*this.maxLength]),t++;s.set(this.message.data,[t*this.maxLength]),this.fullMessage=s}fragmentation(){let e=[],s=0;for(let t=0;t<this.fullMessage.length;t+=this.maxLength){s=this.fullMessage.length-t>this.maxLength?this.maxLength:this.fullMessage.length-t;let r=this.fullMessage.slice(t,t+s);e.push(r)}return e}clear(){this.message=null,this.fullMessage=null}}const j=new P,V={ControlMessage:u,ControlCommand:v,Data:R,Acknowledge:L,Error:T,FragmentTypeToString:O,assembler:j}}}]);
//# sourceMappingURL=652.300f34f7.js.map